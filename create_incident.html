<!DOCTYPE html>
<html>
  <head>
      <title>New Incident</title>
      <link rel='stylesheet' type='text/css' href='assets/main.css'>
      <link rel='stylesheet' type='text/css' href='assets/semantic.min.css'>
      <link rel='stylesheet' type='text/css' href='assets/components/dropdown.min.css'>
      <script src='assets/jquery.min.js'></script>
      <script src='assets/components/dropdown.min.js'></script>
      <script src='assets/semantic.min.js'></script>
      <script src='assets/main.js'></script>
      <script>
        $(function() {
          $('.ui.dropdown').dropdown();
          var user_id = localStorage.getItem('user_id');
          var role_id = localStorage.getItem('role');
          if (!user_id || !role_id) {
            window.location.replace('index.html');
          }
          $.ajax({
            url: "http://ec2-54-237-22-83.compute-1.amazonaws.com/buildings/user/" + user_id,
            success: function (data) {
              $.each(data, function(key, building){
                $('#building-dropdown').append("<div class='item' data-value='" + building.building_id + "'>" + building.address + "</div>");
              });
            },
            error: function (data) {
            }
          })
          $("#building-select").dropdown({
              onChange: function (val) {
                $('#floor-select').removeClass('disabled');
                $('#space-select').addClass('disabled').dropdown('clear');
                $('#floor-dropdown').html('');
                $('#floor-select').dropdown('clear');
                $.ajax({
                  url: "http://ec2-54-237-22-83.compute-1.amazonaws.com/locations/building/" + val,
                  success: function (data) {
                    var unique_floors = [];
                    $.each(data, function(key, location){
                      if ( $.inArray(location.floor, unique_floors) == -1 ) {
                        unique_floors[key] = location.floor;
                        $('#floor-dropdown').append("<div class='item' data-value='" + location.floor + "'>" + location.floor + "</div>");
                      }
                    });
                  },
                  error: function (data) {
                  }
                })
              }
          });
          $("#floor-select").dropdown({
              onChange: function (val) {
                $('#space-select').removeClass('disabled').dropdown('clear');;
                $('#space-dropdown').html('');
                $.ajax({
                  url: "http://ec2-54-237-22-83.compute-1.amazonaws.com/locations/building/" + $('#selected-building-id').val() + "/floor/" +val,
                  success: function (data) {
                    var unique_spaces = [];
                    $.each(data, function(key, location){
                      if ( $.inArray(location.space_name, unique_spaces) == -1 ) {
                        unique_spaces[key] = location.space_name;
                        $('#space-dropdown').append("<div class='item' data-value='" + location.space_name + "'>" + location.space_name + "</div>");
                      }
                    });
                  },
                  error: function (data) {
                  }
                })
              }
          });
        });
        function capturePhoto(){
            navigator.camera.getPicture(uploadPhoto,null,{sourceType:1,quality:60});
        }
        function uploadPhoto(data){
        // this is where you would send the image file to server
        debugger;
        //output image to screen
            cameraPic.src = "data:image/jpeg;base64," + data;
        }
      </script>
  </head>
  <body bgcolor='#242624'>
    <div class="ui top sidebar ui segment">
      <div class="ui center aligned page grid">
        <div class="one column row">
          <div class="sixteen wide column">
            <h3 id="logout"class="ui header">Logout</h3>
          </div>
        </div>
      </div>
    </div>
    <div class='ui piled segment'>
      <div class='ui teal dividing header'>
        <i class='configure icon left'></i>
        <div class='content left'>
          Fix It Now!
          <div class='sub header'>A Crowd Sourced Facility Management Tool</div>
        </div>
        <i class='sidebar icon right'></i>
      </div>
    </div>
    <div id='main'>
      <div id="camera">
          <button class="camera-control" onclick="capturePhoto();">Capture Photo</button>
          <div style="text-align:center;margin:20px;">
              <img id="cameraPic" src="" style="width:auto;height:120px;"></img>
          </div>
      </div>
    </div>
  </body>
</html>